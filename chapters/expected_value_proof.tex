\chapter{Expected value proof}\label{chap:expected_value_proof}


\section{Upper bound}\label{sec:results:upperbound}
Before proving part (b) of the main theorem, we will prove a lemma that shows that a cyclic group of prime order is covered by the sums of a random subset of logarithmic size almost alwasys.
\begin{lemma}\label{lem:sumset}
    Let $q$ be a prime number and $\mathcal{A}$ be a random subset of $\mathbb{Z}_q$ of size $4\lfloor3\log_2 q\rfloor$. As $q$ tends to infinity, $2\lfloor3\log_2 q\rfloor \mathcal{A}$ covers $\mathbb{Z}_q$ almost always. 
\end{lemma}

\textbf{Proof. } Let $s \in \mathbb{N}$ such that $s\leq q$. Let $\mathcal{A}$ be a uniformly random subset of $\mathbb{Z}_q$ of size $s$, that is, 
\[\Pr(\mathcal{A}) = \frac{1}{\binom{q}{s}}.\]
For a given $z \in \mathbb{Z}_q$ and $k \in \mathbb{N}$ for which $k \leq s/2$, let 
\[N_z^k := \left\{K \subseteq \mathbb{Z}_q: |K| = k, \sum_{t \in K} t = z\right\}.\]
Note that $|N_z^k| = \frac{1}{q}{\binom{q}{k}}$, since $K \in N_0^k$ if and only if $K + k^{-1}z \in N_z^k$ for every $z \in \mathbb{Z}_q$.\par
For $K \in N_z^k$, let $E_K$ be the event that $K \subset\mathcal{A}$. Let $X_K$ be the indicator variable of $E_K$.
We define the random variable 
\[X_z = \sum_{K \in N_z^k} X_K.\]
Note that $X_z$ counts the number of sets of size $k$ which add up to $z$. We now find $\EE[X_z]$. Since the sum of every subset $K \subset S$ is in $\mathbb{Z}_q$,
\[\sum_{z \in Z_q} X_z = {\binom{s}{k}},\]
and so
\[\binom{s}{k} = E\left[\sum_{z \in Z_q} X_z\right] =  \sum_{z \in Z_q} E[X_z].\]\par
As in the argument for finding $|N_z^k|$, for every $z \in \mathbb{Z}_q$, 
\[\EE[X_0] = \sum_{K \in N_0^k}\EE[X_K] = \sum_{K \in N_0^k} \EE[X_{K + k^{-1}z}] = \sum_{K \in N_z^k} \EE[X_K] = \EE[X_z].\]
Therefore, we have that
\begin{equation}\label{eq:upperbound:expected}
E[X_z] = \frac{1}{q} {\binom{s}{k}}.
\end{equation}
Now, for $K, L \in N_z^k$, let $j \in \mathbb{N}$ such that $j \leq k$ and define
\[\Delta_j := \sum_{|K \cap L| = j} \Pr[E_K \land E_L].\]
\par 
If $|K \cap L| = j$,
\[\Pr[E_K \land E_L] = \frac{\binom{q - 2k + j}{s - 2k + j}}{\binom{q}{s}}.\]
\par
We can bound the number of events for which $|K \cap L| = j$. First we choose $K$ as any set in $N_z^k$ and then we choose the remaining $k- j$ elements as any subset of $\mathbb{Z}_q \setminus K$ with size $k - j$. Thus, 
\[\Delta_j \leq \frac{1}{q}\binom{q}{k}\binom{q - k}{k - j} \frac{\binom{q - 2k + j}{s - 2k + j}}{\binom{q}{s}}.\]
\par This implies that, using \ref{eq:upperbound:expected},
\begin{align*}
    \frac{\Delta_j}{\EE[X_z]^2} &\leq \frac{\binom{q}{k} \binom{q - k}{k - j}\binom{q - 2k + j}{s - 2k + j}}{\frac{1}{q} \binom{s}{k}\frac{1}{q} \binom{s}{k}q\binom{q}{s}} \\
    &= \frac{\frac{q!}{(q - k)!k!}\frac{(p - k)!}{(k - j)!(q - 2k + k)!}\frac{(q - 2k + j)!}{(s - 2k + j)!(q - s)!}}{\frac{1}{q}\binom{s}{k}\frac{s!}{(s - k)!k!}\frac{q!}{(q - s)!s!}} \\
    &= \frac{q\binom{s - k}{k - j}}{\binom{s}{k}}.
\end{align*}
Let $s = 4\lfloor 3 \log_2 q \rfloor$ and $k = 2\lfloor 3 \log_2 q \rfloor$. Using that $\binom{s - k}{k - j}$ is maximized at $k - j = \lfloor (s - k) / 2\rfloor$,
\begin{align*}
\frac{\Delta_j}{\EE[X_z]^2} \leq \frac{q \binom{2\lfloor 3 \log_2 q\rfloor}{\lfloor 3 \log_2 q \rfloor}}{\binom{4\lfloor 3\log_2 q \rfloor}{2\lfloor 3\log_2 q \rfloor}} \leq \frac{q}{\binom{2\lfloor 3 \log_2 q \rfloor }{ \lfloor 3 \log_2 q \rfloor}} \leq \frac{q}{2^{\lfloor 3 \log_2 q \rfloor}} \sim \frac{1}{q^2},
\end{align*}
since \(\binom{2\lfloor \log_2 q \rfloor}{\lfloor 3 \log_2 q \rfloor}^2 \leq \binom{4\lfloor 3 \log_2 q \rfloor }{2\lfloor 3 \log_2 q \rfloor}\) (Proposition \ref{ap:prop:binom}).   \par
Hence, by (\ref{eq:probmet:deltainequality}) and Theorem \ref{thm:probmet:secondmoment:1},
\begin{align*}
\Pr[X_z = 0] \leq \frac{\EE[X_z] + \Delta}{\EE[X_z]^2} &= \frac{1}{E[X_z]} + \sum_{j = 0}^k \frac{\Delta_j}{\EE[X_z]^2} \\
&\leq \frac{1}{E[X_z]} + \frac{(k + 1)}{q^2} = \frac{1}{E[X_z]} + \frac{2\lfloor 3 \log_2 q\rfloor + 1}{q^2}.
\end{align*}
Therefore, by the union bound and since $q \to \infty$ as $p \to 0$,
\[\Pr\left[\bigvee_{z \in \mathbb{Z}_q} X_z = 0\right] \leq \frac{q}{E[X_z]} + \frac{2\lfloor 3 \log_2 q\rfloor + 1}{q^2} = o(1).\]
We conclude that $X_z > 0$ for every $z \in \mathbb{Z}_q$ almost always. Thus, for every $z \in \mathbb{Z}_q$, there exists $K \in N_z^k$ such that $K \subset \mathcal{A}$ almost always. This means that $2\lfloor 3 \log_2 q\rfloor \mathcal{A}$ covers $\mathbb{Z}_q$ almost always. \qed

\subsection{Proof of the upper bound} 
\begin{lemma}\label{lem:upperbound}
    Let $\psi(x)$ be a function for which $x(\log x)^2 \in o(\psi(x))$ .Then
    \[\lim_{p \to 0}\Pr\left[F(\mathcal{S}) \leq \psi\left(\frac{1}{p}\right)\right] = 1.\] 
\end{lemma}

\par The proof of this theorem consists of several parts. The strategy is to prove that the Ápery set of a subsemigroup of $S$ is completed before step $\psi\left(\frac{1}{p}\right)$ with high probability, since $F(\mathcal{S})$ is less than the maximum element of this Ápery set. The proof has the following structure: 
\begin{enumerate}
\item First, we will find a step for which a prime $q$ is chosen with high probability ($E_1$). 
\item Then, in the spirit of Lemma \ref{lem:sumset} we will find a step such that a set $\mathcal{A}$ of $s$ elements which are different modulo $q$ are chosen with high probability ($E_2$). 
\item Finally, we will apply Lemma \ref{lem:sumset} to $\mathrm{Ap}(\langle \mathcal{A} \cup \{q\}\rangle, q)$.
\end{enumerate}
\textbf{Proof. }
\subsubsection*{Part 1} 
Let \(h(x)\) be a function such that \(h(x) \in o(x (\log x)^2)\) and \(x\log x \in o(h(x))\). Let $t(x) = 20x \log x$. Consider the event
$E_1$ that there exists a prime $q \in \mathcal{S}$, such that 
\[t\left(\frac{1}{p}\right) \leq q \leq h\left(\frac{1}{p}\right).\]
\par 
Let $q_n$ be the $n$-th prime number. By the prime number theorem \cite[Theorem 8]{hardy1979introduction}, 
\begin{equation}\label{eq:pnt}
q_n \sim n \log n.
\end{equation}
Let $k(x)$ be the number of primes between $t(x)$ and $h(x)$. Now, for sufficiently large $n$, $t(n) \leq q_{20n}$. Also, for every $c \in \RR^+$, $q_{cn} \in o(h(n))$ since $cn\log cn \in o(h(n))$. Thus, for sufficiently large $x$ and every $c \in \RR^+$, $k(x) > cx$
and we get that
\[\lim_{p \to 0}\Pr[\lnot E_1] \leq \lim_{p \to 0} (1 - p)^{k(1/p)} \leq \lim_{p \to 0} (1 - p)^{\frac{c}{p}} = e^{-c}.\]
Therefore, 
\begin{equation}\label{eq:upperbound:e1}
    \lim_{p \to 0}\Pr[E_1] = 1.
\end{equation}
\subsubsection*{Part 2}

Now, assume $E_1$. Then $\mathcal{S}$ contains a prime number $q$ for which 
\[t\left(\frac{1}{p}\right) \leq q \leq h\left(\frac{1}{p}\right).\]
\par Let $q$ be such a prime. Let $s = 4\lfloor3\log_2 q \rfloor$, as in Lemma \ref{lem:sumset}. Let $T = \{1, \ldots,  q\}$. Consider the event $E_2$ that at least $s$ generators are selected in $T$. Let $X_1$ be the number of generators selected in $T$, then $X_1 \sim \mathrm{Bin}(q, p)$. We first show that for sufficiently small $p$, $qp > s$ in order to use a bound of the left tail of the binomial distribution (Proposition \ref{ap:prop:leftbinomtail}). \par
Since 
\[q \geq t\left(\frac{1}{p}\right) = \frac{20}{p}\log\frac{1}{p},\]
then 
\begin{equation*}
qp \geq 20\log\frac{1}{p}.
\end{equation*}
Also, since 
\[q \leq h\left(\frac{1}{p}\right) \leq \frac{1}{p}\left(\log\frac{1}{p}\right)^2,\]
then
\[s = 4\lfloor3\log_2 q \rfloor \leq 4\left\lfloor3\log_2 \frac{1}{p}\left(\log\frac{1}{p}\right)^2 \right\rfloor = 4\left\lfloor3\log_2 \frac{1}{p} + 6\log_2 \log\frac{1}{p} \right\rfloor.\]
Thus, for sufficiently small $p$, $qp> s$ and we can use Proposition \ref{ap:prop:leftbinomtail} with $r = s$ to show that
\begin{align*}
    \Pr[ \overline{E_2}  | E_1] = \Pr\left[X_1 < s\right] \leq \frac{(q - s)p}{(qp - s)^2}.
\end{align*}
\par Thus, bounding by the worst case asymptotically, 

\begin{align*}
    \lim_{p \to 0} P[\overline{E_2} | E_1] &\leq \lim_{p \to 0}\frac{\left(h\left(\frac{1}{p}\right) - 4\left\lfloor3\log_2 t\left(\frac{1}{p}\right) \right\rfloor\right)p}{\left(t\left(\frac{1}{p}\right)p - 4\left\lfloor3\log_2 h\left(\frac{1}{p}\right) \right\rfloor\right)^2} \\
    &\leq \lim_{p \to 0}\frac{\left(h\left(\frac{1}{p}\right) - 4\left\lfloor3\log_2 \frac{20}{p}\log\frac{1}{p} \right\rfloor\right)p}{\left(20\log\frac{1}{p} - 4\left\lfloor3\log_2 \frac{1}{p}\left(\log\frac{1}{p}\right)^2 \right\rfloor\right)^2}\\
    &=\lim_{p \to 0} \frac{o\left(\frac{1}{p}\left(\log\frac{1}{p}\right)^2\right)p}{\left(20\log\frac{1}{p} - 4\left\lfloor3\log_2 \frac{1}{p}\left(\log\frac{1}{p}\right)^2 \right\rfloor\right)^2}\\
    &=\lim_{p \to 0} \frac{o\left(\left(\log\frac{1}{p}\right)^2\right)}{\left(20\log\frac{1}{p} - 4\left\lfloor3\log_2 \frac{1}{p}\left(\log\frac{1}{p}\right)^2 \right\rfloor\right)^2} = 0.
\end{align*}

\par We conclude that
\[\lim_{p \to 0} \Pr[E_2 | E_1] = 1,\]
and so, using (\ref{eq:upperbound:e1}),
\[\lim_{p \to 0} \Pr[E_1 \land E_2] = \lim_{p \to 0} \Pr[E_2  | E_1]\Pr[E_1] = 1.\]


\subsubsection*{Part 3}

\par Finally, assume $E_1$ and $E_2$. Let $\mathcal{A} = \{Y_{1}, \ldots, Y_{s}\}$ be a randomly selected subset of size $s$ of the generators selected in $T$.  Since the generators are chosen randomly and $|T| = q$, we can apply Lemma \ref{lem:sumset} to $\ZZ_q \cong \mathrm{Ap}(\langle\mathcal{A}\cup\{q\}\rangle, q)$ to get that it will be completed before step \[ qs\leq h\left(\frac{1}{p}\right)2\left\lfloor 3\log_2 h\left(\frac{1}{p}\right)\right\rfloor \in O\left(h\left(\frac{1}{p}\right)\log \frac{1}{p}\right),\]
almost always as $p \to 0$. 
\par Thus, if
\[\psi(x) = h\left(x\right)2\left\lfloor 3\log_2 x\right\rfloor,\]
we have that $x(\log x)^2 \in o(\psi(x))$ and
\[\lim_{p \to  0} \Pr\left[F(\langle\mathcal{A}\cup \{q\}\rangle) \leq \psi\left(\frac{1}{p}\right)\right] = 1.\]
Since $F(\mathcal{S}) \leq F(\langle \mathcal{A}\cup\{q\}\rangle)$, we conclude that
\[\lim_{p \to 0}\Pr\left[F(\mathcal{S}) \leq \psi\left(\frac{1}{p}\right)\right] = 1.\]
Since the constraints on $h(x)$ are independent of multiplication by constants, the result is true for any function $\psi$ such that $x(\log x)^2 \in \psi(g(x))$. \qed \par
The bound on the Frobenius number also implies bounds on the genus and the embedding dimension.
\begin{corollary}
    Let $\psi(x)$ be a function for which $x(\log x)^2 \in o(\psi(x))$ .Then
    \[\lim_{p \to 0}\Pr\left[g(\mathcal{S}) \leq \psi\left(\frac{1}{p}\right)\right] = 1.\]
\end{corollary}
\textbf{Proof. } Use Proposition \ref{prop:smgps:frobgenus}. \qed
\begin{corollary}
    Let $\varphi(x)$ be a function for which $(\log x)^2 \in o(\varphi(x))$ .Then
    \[\lim_{p \to 0}\Pr\left[e(\mathcal{S}) \leq \varphi\left(\frac{1}{p}\right)\right] = 1.\]
\end{corollary}
\textbf{Proof. } Since
\[\lim_{p \to 0}\Pr\left[F(\mathcal{S}) \leq \psi\left(\frac{1}{p}\right)\right] = 1,\]
and the maximal element of the minimal generating set is at most $2F(\mathcal{S})$, the elements of the minimal generating set are chosen before step $2\psi\left(\frac{1}{p}\right)$ with high probability. Since \[\left|\mathcal{A}\cap\left\{1, \ldots, \left\lfloor2\psi\left(\frac{1}{p}\right)\right \rfloor\right\}\right| \sim \mathrm{Bin}\left(\left\lfloor2\psi\left(\frac{1}{p}\right)\right \rfloor, p\right),\] by the bound on the right tail of the binomial distribution (Proposition \ref{ap:prop:rightbinomtail}), we have that
\[\lim_{p \to 0}\Pr\left[e(\mathcal{S}) \leq (3p)\psi\left(\frac{1}{p}\right)\right] = 1.\]
Thus, if $\varphi(x) = \frac{3}{x} \psi\left(x\right)$, then $(\log x)^2 \in \varphi(x)$ and 
\[\lim_{p \to 0}\Pr\left[e(\mathcal{S}) \leq \varphi\left(\frac{1}{p}\right)\right] = 1.\qed \]
